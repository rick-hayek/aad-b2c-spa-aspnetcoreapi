# Set up this single page application from scratch

This is gonna be long. I'm trying to explain details about how all those frontend related technologies and tools work under the hood, specifically, for node.js, express, webpack, and babel.

## Prerequisites

[node.js](https://nodejs.org/) is required to be installed.

## Environment

This demo application is running under (should work in an environment with higher versions):

- nodejs@v11.13.0
- npm@6.7.0
- webpack@4.29.6
- express@4.16.4

## Construct the folder hierarchy

Launch a terminal, and go to your working directory. Then issue following commands:

```bash
mkdir web
cd web
mkdir -p src
npm init -y
```

## Setting up webpack

Why [webpack](https://webpack.js.org/concepts)? Here's a [great article](https://blog.andrewray.me/webpack-when-to-use-and-why/) talking about the ability that webpack has.

### Initial setup for webpack

```bash
npm i webpack webpack-cli --save-dev
```

Open up the [package.json](https://docs.npmjs.com/files/package.json), which is generated by `npm init`, and add `"build": "webpack"` to `"scripts"` section:

```json
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack"
  },
```

Now from terminal (in \web\\), run command:

```bash
npm run build
```

You will get errors that complain **"Entry module not found"**. The error should be something like:

```console
ERROR in Entry module not found: Error: Can't resolve './src' in 'C:\src\rickrepo\aad-b2c-spa-aspnetcoreapi\web'
npm ERR! code ELIFECYCLE
npm ERR! errno 2
npm ERR! web@1.0.0 build: `webpack`
npm ERR! Exit status 2
npm ERR!
npm ERR! Failed at the web@1.0.0 build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
```

The error occurs because webpack is trying to find the entry point that is specified in configure file. Since we haven't create any configuration file, the default one will be "./src/index.js".

```text
Since version 4.0.0, webpack does not require a configuration file to bundle your project.
```

So let's create the index.js in ./src/:

```bash
cd src
touch index.js
```

And add the following contents to index.js:

```JavaScript
console.log("hello webpack!");
```

Now from terminal, go back to \web folder, run `npm run build` again:

```bash
cd ..
npm run build
```

Now it should run without any error. And you will be finding out that a new file `.\dist\main.js` is generated by webpack.

#### production & development mode

You will also notice that there's a WARNING message along with the build output:

```text
WARNING in configuration
The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.aults for each environment.
```

A production bundled output will be minified. Modify the package.json as following:

```json
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "dev": "webpack --mode development",
    "build": "webpack --mode production"
  },
```

Then compare the `.\dist\main.js` after running `npm run dev` and `npm run build`. You will find the differences.

### Using a configuration file for webpack

Using default values is fair enough for a startup or learning project, while you should use configuration files for large/complex/production web project.

Create a new file `webpack.config.js` (in \web\\):

```bash
touch webpack.config.js
```

and make initial values:

```javascript
module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "bundle.js"
  }
}
```

Now run `npm run build`, you will find `.\dist\bundle.js` is generated (instead of the default main.js). This is where you can define all your customization and extend configurations. For now we can leave everything here. We will go back to this `webpack.config.js` soon.

For more advanced configurations, check this [document](https://webpack.js.org/configuration).

## Set up node web server

Create `app.js`:

```bash
touch app.js
```

Let's initialize the file by following [node.js start guide](https://nodejs.org/en/docs/guides/getting-started-guide/). Put below contents into `app.js`:

```javascript
const http = require('http');

const hostname = '127.0.0.1';
const port = 3000;

const server = http.createServer((req, res) => {
  res.statusCode = 200;
  res.setHeader('Content-Type', 'text/plain');
  res.end('Hello World\n');
});

server.listen(port, hostname, () => {
  console.log(`Server running at http://${hostname}:${port}/`);
});
```

From terminal, issue command:

```bash
node app.js
```

and then open browser, navigate to http://127.0.0.1:3000. You can find that it returns `Hello World`, just as what we have defined in `app.js`.

### Start server from package.json

Open up `package.json`, and modify the `scripts` section as below:

```json
"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
  "dev": "webpack --mode development",
  "build": "webpack --mode production",
  "start": "node app"
},
```

Now run command:

```bash
npm start
```

## Set up Express

Install express:

```bash
npm i express
```
